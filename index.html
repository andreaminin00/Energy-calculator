<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar Panel Energy Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: black;
            color: white;
            font-family: 'Quicksand', sans-serif;
            font-size: 16px;
            text-align: center;
        }
        h2, button {
            font-family: 'Lato', sans-serif;
        }
        .container {
            margin-top: 50px;
        }
        input, button {
            font-size: 16px;
            margin: 10px;
            padding: 5px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div id="input-container" class="container">
        <h2>Enter Parameters</h2>
        <label>Panel Area (m²): <input type="number" id="area" value="1"></label><br>
        <label>Nominal Efficiency (%): <input type="number" id="nom_eff" value="20"></label><br>
        <label>Efficiency Decrease (%/°C): <input type="number" id="decr" value="0.4"></label><br>
        <label>Heating Rate (°C/min): <input type="number" id="heating_rate" value="3.5"></label><br>
        <label>Initial Temperature (°C): <input type="number" id="initial_temp" value="25"></label><br>
        <label>Final Temperature (°C): <input type="number" id="final_temp" value="65"></label><br>
        <label>Solar Irradiance (kWh/m²/day): <input type="number" id="irradiance" value="5"></label><br>
        <label>Day Length (hours): <input type="number" id="day_length" value="12"></label><br>
        <button id="calculate-btn">Calculate</button>
    </div>
    
    <div id="results-container" class="container hidden">
        <h2>Results</h2>
        <p id="results"></p>
        <button id="close-btn">Close</button>
    </div>

    <script>
        document.getElementById("calculate-btn").addEventListener("click", function() {
            try {
                let area = parseFloat(document.getElementById("area").value);
                let nom_eff = parseFloat(document.getElementById("nom_eff").value) / 100;
                let decr = parseFloat(document.getElementById("decr").value) / 100;
                let heating_rate = parseFloat(document.getElementById("heating_rate").value);
                let initial_temp = parseFloat(document.getElementById("initial_temp").value);
                let final_temp = parseFloat(document.getElementById("final_temp").value);
                let irradiance = parseFloat(document.getElementById("irradiance").value);
                let day_length = parseFloat(document.getElementById("day_length").value);

                let I = (irradiance / day_length) * 1000; // Convert kWh/m²/day to W/m²
                let delta_T = final_temp - initial_temp;
                let t_heat = delta_T / heating_rate; // Time to reach final temperature in minutes
                let k = decr * heating_rate;

                let integral_value = t_heat * (1 - 0.5 * k * t_heat);
                let E_heat = I * area * nom_eff * (integral_value / 60);

                let eff_plateau = nom_eff * (1 - k * delta_T);
                let t_plateau = (day_length * 60) - t_heat;
                let E_plateau = I * area * eff_plateau * (t_plateau / 60);

                let E_tot_Wh = E_heat + E_plateau;
                let E_tot_kWh = E_tot_Wh / 1000;

                let result_text = `Heating time: ${t_heat.toFixed(2)} minutes<br>
                                   Energy during heating: ${E_heat.toFixed(2)} Wh<br>
                                   Energy during plateau: ${E_plateau.toFixed(2)} Wh<br>
                                   TOTAL ENERGY: ${E_tot_Wh.toFixed(2)} Wh (${E_tot_kWh.toFixed(2)} kWh)`;

                document.getElementById("results").innerHTML = result_text;
                document.getElementById("input-container").classList.add("hidden");
                document.getElementById("results-container").classList.remove("hidden");
            } catch (error) {
                document.getElementById("results").innerHTML = `Error: ${error.message}`;
                document.getElementById("results-container").classList.remove("hidden");
            }
        });
        
        document.getElementById("close-btn").addEventListener("click", function() {
            document.getElementById("results-container").classList.add("hidden");
            document.getElementById("input-container").classList.remove("hidden");
            document.getElementById("results").innerHTML = "";
            document.querySelectorAll("input").forEach(input => input.value = "");
        });
    </script>
</body>
</html>