function calculateEnergy() {
    // Read user inputs
    let area = parseFloat(document.getElementById("area").value);
    let efficiency = parseFloat(document.getElementById("efficiency").value) / 100;
    let eff_decrease = parseFloat(document.getElementById("eff_decrease").value) / 100;
    let heat_rate = parseFloat(document.getElementById("heat_rate").value);
    let temp_start = parseFloat(document.getElementById("temp_start").value);
    let temp_end = parseFloat(document.getElementById("temp_end").value);
    let irradiance = parseFloat(document.getElementById("irradiance").value);
    let day_length = parseFloat(document.getElementById("day_length").value);

    // Calculate heating time
    let delta_T = temp_end - temp_start;
    let heat_time = delta_T / heat_rate; // minutes

    // Convert irradiance to W/mÂ²
    let I = (irradiance / day_length) * 1000; 

    // Calculate efficiency decrease factor
    let k = eff_decrease * heat_rate;
    
    // Energy during heating phase (integral calculation)
    let integral_factor = (heat_time - 0.5 * k * (heat_time ** 2));
    let energy_heat = I * area * efficiency * (integral_factor / 60); // in Wh

    // Energy during plateau phase
    let eff_plateau = efficiency * (1 - k * delta_T);
    let plateau_time = (day_length * 60) - heat_time;
    let energy_plateau = I * area * eff_plateau * (plateau_time / 60); // in Wh

    // Total energy
    let total_energy_Wh = energy_heat + energy_plateau;
    let total_energy_kWh = total_energy_Wh / 1000;

    // Show results
    let resultText = `
        <strong>Heating time:</strong> ${heat_time.toFixed(2)} minutes<br>
        <strong>Energy during heating:</strong> ${energy_heat.toFixed(2)} Wh<br>
        <strong>Energy during plateau:</strong> ${energy_plateau.toFixed(2)} Wh<br>
        <strong>Total Energy:</strong> ${total_energy_Wh.toFixed(2)} Wh (${total_energy_kWh.toFixed(2)} kWh)
    `;

    document.getElementById("output").innerHTML = resultText;

    // Hide input container and show results
    document.getElementById("input-container").style.display = "none";
    document.getElementById("results").style.display = "block";
}

function resetForm() {
    document.getElementById("results").style.display = "none";
    document.getElementById("input-container").style.display = "block";

    // Reset input values
    document.getElementById("area").value = "1";
    document.getElementById("efficiency").value = "20";
    document.getElementById("eff_decrease").value = "0.4";
    document.getElementById("heat_rate").value = "3.5";
    document.getElementById("temp_start").value = "25";
    document.getElementById("temp_end").value = "65";
    document.getElementById("irradiance").value = "5";
    document.getElementById("day_length").value = "12";
}
